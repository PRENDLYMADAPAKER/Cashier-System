<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dental Cashier System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d1117;
      color: #e6edf3;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .card {
      background: #161b22;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    button {
      background: #238636;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      margin-top: 5px;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #30363d;
      text-align: center;
    }
    .report-actions {
      margin: 20px 0;
      text-align: center;
    }
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .modal-content {
      background: #161b22;
      padding: 20px;
      border-radius: 10px;
      max-height: 80%;
      overflow-y: auto;
    }
    .modal-content h2 {
      margin-top: 0;
    }
    .modal-content input {
      width: 80px;
      padding: 5px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #30363d;
      background: #0d1117;
      color: #e6edf3;
    }
  </style>
</head>
<body>

<h1>Dental Cashier System</h1>

<div class="container" id="itemsContainer"></div>

<div class="report-actions">
  <button onclick="showReport()">View Sales Report</button>
  <button onclick="exportCSV()">Export CSV</button>
  <button onclick="printReport()">Print Report</button>
  <button onclick="resetSystem()">Reset System</button>
</div>

<div id="reportSection" class="card" style="display:none;">
  <h2>Sales Report</h2>
  <table id="reportTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Qty Sold</th>
        <th>Total Sales (₱)</th>
        <th>Remaining Stock</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <h3 id="grandTotal"></h3>
</div>

<!-- Stock Setup Modal -->
<div class="modal" id="stockModal">
  <div class="modal-content">
    <h2>Enter Initial Stock</h2>
    <form id="stockForm"></form>
    <button onclick="saveInitialStock()">Save Stock</button>
  </div>
</div>

<script>
const items = [
  { name: "Complete Denture Live Patient", price: 15 },
  { name: "Complete Denture Cast", price: 10 },
  { name: "RPD Drawing", price: 5 },
  { name: "RPD Cast Grading", price: 10 },
  { name: "RPD Live Grading", price: 10 },
  { name: "Endodontics", price: 50 },
  { name: "Perio/OP", price: 15 },
  { name: "Oral Surgery", price: 10 },
  { name: "PFM & FPD Typodonts", price: 10 },
  { name: "PFM & FPD Live", price: 15 },
  { name: "Restorative Typodonts", price: 5 },
  { name: "Restorative Live", price: 10 },
  { name: "Mastercard Patient/Student", price: 30 },
  { name: "31 Accomplishment", price: 25 },
  { name: "32 Accomplishment", price: 35 },
  { name: "41 Accomplishment", price: 30 },
  { name: "42 Accomplishment", price: 20 }
];

let salesData = JSON.parse(localStorage.getItem("salesData")) || {};
let stockData = JSON.parse(localStorage.getItem("stockData")) || {};

function init() {
  const container = document.getElementById("itemsContainer");
  container.innerHTML = "";
  items.forEach((item, index) => {
    if (!salesData[item.name]) salesData[item.name] = 0;
    if (!stockData[item.name]) stockData[item.name] = 0;

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h3>${item.name}</h3>
      <p>Price: ₱${item.price}</p>
      <p>Remaining: <span id="stock-${index}">${stockData[item.name]}</span></p>
      <button onclick="purchaseItem(${index})" id="btn-${index}" ${stockData[item.name] <= 0 ? "disabled" : ""}>
        Sell One
      </button>
    `;
    container.appendChild(card);
  });
  localStorage.setItem("salesData", JSON.stringify(salesData));
  localStorage.setItem("stockData", JSON.stringify(stockData));
}

function purchaseItem(index) {
  const item = items[index];
  if (stockData[item.name] > 0) {
    salesData[item.name]++;
    stockData[item.name]--;
    document.getElementById(`stock-${index}`).textContent = stockData[item.name];
    if (stockData[item.name] <= 0) {
      document.getElementById(`btn-${index}`).disabled = true;
    }
    localStorage.setItem("salesData", JSON.stringify(salesData));
    localStorage.setItem("stockData", JSON.stringify(stockData));
  }
}

function showReport() {
  const tbody = document.querySelector("#reportTable tbody");
  tbody.innerHTML = "";
  let grandTotal = 0;

  items.forEach(item => {
    const sold = salesData[item.name] || 0;
    const total = sold * item.price;
    const remaining = stockData[item.name] || 0;
    if (sold > 0 || remaining >= 0) {
      const row = `<tr>
        <td>${item.name}</td>
        <td>${sold}</td>
        <td>₱${total}</td>
        <td>${remaining}</td>
      </tr>`;
      tbody.innerHTML += row;
      grandTotal += total;
    }
  });
  document.getElementById("grandTotal").textContent = "Grand Total: ₱" + grandTotal;
  document.getElementById("reportSection").style.display = "block";
}

function exportCSV() {
  let csv = "Item,Qty Sold,Total Sales,Remaining Stock\n";
  items.forEach(item => {
    const sold = salesData[item.name] || 0;
    const total = sold * item.price;
    const remaining = stockData[item.name] || 0;
    csv += `"${item.name}",${sold},${total},${remaining}\n`;
  });
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "sales_report.csv";
  a.click();
  URL.revokeObjectURL(url);
}

function printReport() {
  const report = document.getElementById("reportSection").innerHTML;
  const win = window.open("", "", "width=900,height=600");
  win.document.write("<html><head><title>Print Report</title></head><body>");
  win.document.write(report);
  win.document.write("</body></html>");
  win.document.close();
  win.print();
}

function resetSystem() {
  if (confirm("Reset system? This will clear all data.")) {
    localStorage.removeItem("salesData");
    localStorage.removeItem("stockData");
    salesData = {};
    stockData = {};
    document.getElementById("stockModal").style.display = "flex";
  }
}

function saveInitialStock() {
  const form = document.getElementById("stockForm");
  const inputs = form.querySelectorAll("input");
  stockData = {};
  salesData = {};
  inputs.forEach(input => {
    const name = input.name;
    const value = parseInt(input.value) || 0;
    stockData[name] = value;
    salesData[name] = 0;
  });
  localStorage.setItem("stockData", JSON.stringify(stockData));
  localStorage.setItem("salesData", JSON.stringify(salesData));
  document.getElementById("stockModal").style.display = "none";
  init();
}

// Setup stock form on first load
window.onload = () => {
  const form = document.getElementById("stockForm");
  form.innerHTML = "";
  items.forEach(item => {
    form.innerHTML += `
      <label>${item.name}: 
        <input type="number" name="${item.name}" min="0" required>
      </label><br>
    `;
  });
  if (Object.keys(stockData).length === 0) {
    document.getElementById("stockModal").style.display = "flex";
  } else {
    init();
  }
};
</script>

</body>
  </html>
